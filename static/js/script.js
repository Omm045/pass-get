// script.js refined: ensures both download buttons exist and premium look preserved
class PasswordGenerator{constructor(){this.initEls();this.bind();this.loadTheme();this.updateLength();this.generate();this.pulseAnim();}
initEls(){this.generateBtn=document.getElementById('generateBtn');this.refreshBtn=document.getElementById('refreshBtn');this.copyBtn=document.getElementById('copyBtn');this.downloadBtn=document.getElementById('downloadBtn');this.downloadAppBtn=document.getElementById('downloadAppBtn');this.checkStrengthBtn=document.getElementById('checkStrengthBtn');this.themeSelect=document.getElementById('themeSelect');this.passwordField=document.getElementById('generatedPassword');this.strengthFill=document.getElementById('strengthFill');this.strengthText=document.getElementById('strengthText');this.strengthScore=document.getElementById('strengthScore');this.lengthSlider=document.getElementById('lengthSlider');this.lengthValue=document.getElementById('lengthValue');this.includeUppercase=document.getElementById('includeUppercase');this.includeLowercase=document.getElementById('includeLowercase');this.includeNumbers=document.getElementById('includeNumbers');this.includeSymbols=document.getElementById('includeSymbols');this.excludeAmbiguous=document.getElementById('excludeAmbiguous');this.modal=document.getElementById('customPasswordModal');this.modalClose=document.getElementById('modalClose');this.customPassword=document.getElementById('customPassword');this.togglePassword=document.getElementById('togglePassword');this.analyzeBtn=document.getElementById('analyzeBtn');this.cancelBtn=document.getElementById('cancelBtn');this.customStrengthResult=document.getElementById('customStrengthResult');this.notification=document.getElementById('notification');this.notificationText=document.getElementById('notificationText');}
bind(){this.generateBtn.addEventListener('click',()=>this.generate());this.refreshBtn?.addEventListener('click',()=>this.generate());this.copyBtn.addEventListener('click',()=>this.copy());this.downloadBtn.addEventListener('click',()=>this.download());this.downloadAppBtn.addEventListener('click',()=>this.installApp());this.themeSelect.addEventListener('change',()=>this.changeTheme());this.lengthSlider.addEventListener('input',()=>this.updateLength());this.lengthSlider.addEventListener('change',()=>this.generate());[this.includeUppercase,this.includeLowercase,this.includeNumbers,this.includeSymbols,this.excludeAmbiguous].forEach(el=>el.addEventListener('change',()=>this.generate()));this.checkStrengthBtn.addEventListener('click',()=>this.showModal());this.modalClose.addEventListener('click',()=>this.closeModal());this.cancelBtn.addEventListener('click',()=>this.closeModal());this.analyzeBtn.addEventListener('click',()=>this.analyze());this.togglePassword.addEventListener('click',()=>this.toggleVisibility());document.addEventListener('keydown',e=>{if(e.key==='Escape'&&this.modal.classList.contains('show'))this.closeModal();});document.addEventListener('keypress',e=>{if(e.target.id==='generatedPassword'&&e.key==='Enter'){e.preventDefault();this.copyBtn.click();}});window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();this.deferredPrompt=e;this.downloadAppBtn.style.display='flex';});window.addEventListener('appinstalled',()=>{this.toast('App installed!');this.deferredPrompt=null;});}
loadTheme(){const t=localStorage.getItem('passgen-theme')||'blue';this.themeSelect.value=t;this.applyTheme(t);}changeTheme(){const t=this.themeSelect.value;this.applyTheme(t);localStorage.setItem('passgen-theme',t);}applyTheme(t){document.documentElement.setAttribute('data-theme',t);const primary=getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();this.lengthValue.style.background=`${primary}1a`;}
updateLength(){this.lengthValue.textContent=this.lengthSlider.value;}
async generate(){try{this.generateBtn.disabled=true;this.generateBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...';const o={length:parseInt(this.lengthSlider.value),lowercase:this.includeLowercase.checked,uppercase:this.includeUppercase.checked,digits:this.includeNumbers.checked,symbols:this.includeSymbols.checked,excludeAmbiguous:this.excludeAmbiguous.checked};if(!o.lowercase&&!o.uppercase&&!o.digits&&!o.symbols){this.toast('Please select at least one character type','error');return;}const r=await fetch('/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(o)});const d=await r.json();if(d.success){this.passwordField.value=d.password;this.updateMeter(d.strength);this.bump();}else{this.toast(d.error||'Failed to generate password','error');}}catch(e){this.toast('Failed to generate password','error');}finally{this.generateBtn.disabled=false;this.generateBtn.innerHTML='<i class="fas fa-key"></i> Generate Password';}}
async copy(){const p=this.passwordField.value;if(!p){this.toast('No password to copy','error');return;}try{await navigator.clipboard.writeText(p);this.toast('Password copied to clipboard!');this.copyBtn.innerHTML='<i class="fas fa-check"></i>';setTimeout(()=>this.copyBtn.innerHTML='<i class="fas fa-copy"></i>',2000);}catch(e){this.toast('Failed to copy password','error');}}
 download(){const p=this.passwordField.value;if(!p){this.toast('No password to download','error');return;}const ts=new Date().toISOString().replace(/[:.]/g,'-');const name=`password-${ts}.txt`;const content=`Generated Password: ${p}\n\nGenerated on: ${new Date().toLocaleString()}\nLength: ${p.length} characters\n\nSecurity Note: Store this password securely and do not share it.`;const blob=new Blob([content],{type:'text/plain'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=name;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);this.toast('Password downloaded successfully!');this.downloadBtn.innerHTML='<i class="fas fa-check"></i>';setTimeout(()=>this.downloadBtn.innerHTML='<i class="fas fa-file-arrow-down"></i>',2000);}
updateMeter(s){this.strengthFill.style.width=s.score+'%';this.strengthFill.style.background=s.color;this.strengthText.textContent=s.strength;this.strengthText.style.color=s.color;this.strengthScore.textContent=`${s.score}/100`;this.strengthFill.style.animation=s.strength==='Very Strong'?'pulse 2s infinite':'none';}
bump(){this.passwordField.style.transform='scale(1.02)';this.passwordField.style.transition='transform .2s ease';setTimeout(()=>this.passwordField.style.transform='scale(1)',200);}showModal(){this.modal.classList.add('show');this.customPassword.value='';this.customStrengthResult.innerHTML='<p style="color:var(--text-secondary);text-align:center;">Enter a password above to analyze its strength</p>';setTimeout(()=>this.customPassword.focus(),100);}closeModal(){this.modal.classList.remove('show');this.customPassword.value='';this.customStrengthResult.innerHTML='';}
async analyze(){const p=this.customPassword.value.trim();if(!p){this.customStrengthResult.innerHTML='<p style="color:var(--danger-color);">Please enter a password to analyze</p>';return;}try{this.analyzeBtn.disabled=true;this.analyzeBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Analyzing...';const r=await fetch('/check-strength',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:p})});const d=await r.json();if(d.success){this.showStrength(d.strength);}else{this.customStrengthResult.innerHTML=`<p style="color:var(--danger-color);">${d.error}</p>`;}}catch(e){this.customStrengthResult.innerHTML='<p style="color:var(--danger-color);">Failed to analyze password</p>';}finally{this.analyzeBtn.disabled=false;this.analyzeBtn.innerHTML='Analyze Password';}}
showStrength(s){const fb=s.feedback.length?`<div style="margin-top:1rem;"><h4 style="color:var(--text-primary);margin-bottom:.5rem;font-size:.9rem;">Recommendations:</h4><ul style="margin:0;padding-left:1.25rem;color:var(--text-secondary);font-size:.85rem;">${s.feedback.map(i=>`<li style=\"margin-bottom:.25rem;\">${i}</li>`).join('')}</ul></div>`:'<p style="color:var(--success-color);margin-top:1rem;font-size:.9rem;">âœ“ Excellent password strength!</p>';this.customStrengthResult.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;"><span style="font-weight:600;color:${s.color};font-size:1rem;">${s.strength}</span><span style="color:var(--text-secondary);font-size:.9rem;">${s.score}/100</span></div><div style="width:100%;height:8px;background:var(--border-color);border-radius:4px;overflow:hidden;margin-bottom:.5rem;"><div style="height:100%;width:${s.score}%;background:${s.color};border-radius:4px;transition:all .3s ease;"></div></div>${fb}`;}
toast(m,t='success'){this.notificationText.textContent=m;this.notification.style.background=t==='error'?'var(--danger-color)':'var(--success-color)';this.notification.querySelector('i').className=t==='error'?'fas fa-exclamation-circle':'fas fa-check-circle';this.notification.classList.add('show');setTimeout(()=>this.notification.classList.remove('show'),3000);} 
installApp=async()=>{if(this.deferredPrompt){this.deferredPrompt.prompt();const {outcome}=await this.deferredPrompt.userChoice;this.toast(outcome==='accepted'?'Installing...':'Install dismissed');this.deferredPrompt=null;}else{this.toast('Install not supported in this browser','error');}} 
pulseAnim(){const s=document.createElement('style');s.textContent='@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,.4)}70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}';document.head.appendChild(s);} }

document.addEventListener('DOMContentLoaded',()=>new PasswordGenerator());
window.addEventListener('load',()=>{document.body.style.opacity='0';document.body.style.transition='opacity .3s ease';setTimeout(()=>document.body.style.opacity='1',100)});
